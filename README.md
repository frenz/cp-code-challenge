# Flash purchasing shopping API 
### A User can purchase ONE product for ONE quantity and only for ONE hour. 

## Requirements

* **Docker**
* **Docker Compose**
* **GIT client**

## Docker 
```shell
git@github.com:dev-centralpoint/cp-code-challenge-Giuseppe.git
cd !$
docker-compose up --abort-on-container-exit
```
or
```
docker-compose down &&  docker-compose build  && docker-compose up --abort-on-container-exit
```
### Start messenger:consume-messages
```shell
 ❯❯❯ docker-compose exec php ash
288433f0195b:/var/www# bin/console messenger:consume-messages
```

Make an API application using
* Symfony
* RabbitMQ
* Unit test
* Docker Containers
* Possible API documentation.

Make the following authenticated backend endpoints: 
* Endpoint GET /api/queue/enter : 
    * User enters a queue and waits for a Queue Token (QT) , use JWT if possible (the browser is refreshing with a message)
    * Response is negative if the queue is not ready , full etc, there is an error with a message for the user
    * Generate a Queue Token (QT) preferably using JWT that expires in one hour , add it to RabbitMQ, you will need this message  later in order to validate that the user did not fabricate his own QT and it was only generated by the system. 
    * Response is positive, the user gets the QT in which we can use for the next step. 

Make a queue worker (QWorker) which takes all messages from the RabbitMQ Queue Tokens (QT) and generates new Purchase Tokens (PT) and add them in the Database (for example MySQL).

* Endpoint POST /api/queue/exchange-qt-for-pt:
    * User waits to exchange this QT with a Purchase Token (PT)  preferably using JWT that expires in one hour.
    * Response is negative if the PT is not avaiable yet, remember that the user waits for the QWorker which converts all the QT to PT, token is expired etc with a message for the user
    * Check DB, see if the provided QT has a PT then give the user the (PT)
    * Response is positive the user gets the Purchase Token (PT) in which we can use for the next step. 

* Endpoint POST /api/shop/purchase : 
    * User will provide his Purchase Token (PT) in order to purchase of a new iPhone 11 Pro in a lower price. 
    * Response is negative if the product is out of stock , PT is invalid etc
    * Check DB , see if the provided Purchase Token (PT) is valid , add his order to the Database (for example MySQL)
    * Response is positive  the user gets a message that his order is placed.

